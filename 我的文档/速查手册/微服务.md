# 接口幂等设计

实际上在微服务环境下，所有的远程调用接口都应保持幂等性，因为远程调用一定会面临网络不稳定的问题。

使用幂等表来脱离业务，实现一套无侵入的幂等保证框架，因为不能指望所有同事都懂幂等性。

## 幂等表实现通用幂等性检测

利用 Spring 提供的 AOP ＋ 自定义注解

服务或用户发出的请求的请求头中应包含一个唯一的请求编码来标识请求，服务接到请求并从请求头中获取请求编号，在 Redis 中查询是否存在该编号，若存在则代表请求已被处理过，若不存在则将编号写入 Redis 中，并初始化状态为处理中，并设定编号的过期时间（释放Redis内存避免堆积，且防止与Redis通信出错导致状态更新失败），放行请求执行业务逻辑，执行完成之后更新Redis状态为处理完成，或直接删除。

幂等性需要靠多种方式共同实现，没有一种可以在所有地方使用的方案。

# Seata 分布式事务实现

JSqlParser 解析 sql 并生成回滚日志

