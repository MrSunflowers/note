# InnoDB 存储结构与表的垂直拆分

在 InnoDB 存储引擎中，存储的每条数据称为 row ，由多个 row 组成的称为页 page ，每个页的存储容量默认为 16KB，用于存储连续的行，存储页的结构称为区 extent ，一个区的默认大小为 1MB ，即一个区最多可以装载 64 个连续的页。

表空间是一个逻辑容器，包含多个段（Segment），每个段由一个或多个区（Extent）组成。

1. 行（Row）
- **定义**: 每一条记录称为一行（row），包含表中定义的所有列的数据。
- **存储**: 行数据在页中以紧凑的方式存储，包括实际的数据值和一些额外的元数据，如变长字段长度列表和 NULL 值列表等。

2. 页（Page）
- **定义**: 页是 InnoDB 存储引擎中数据存储的基本单位，多个行（rows）被组织在一个页中。
- **默认大小**: 每个页的默认大小为 16KB，这意味着一个页可以存储大约 8000 字节的数据，具体大小可能会因为行格式和存储方式的不同而略有变化。
- **存储结构**: 
  - **文件头（File Header）**: 包含页的通用信息，如校验和、页面类型等。
  - **页头（Page Header）**: 存储页的元数据，如记录数、空闲空间等。
  - **用户记录（User Records）**: 实际存储的行数据。
  - **空闲空间（Free Space）**: 页中尚未使用的空间，用于插入新记录。
  - **页目录（Page Directory）**: 包含页中记录的相对位置信息，用于快速查找记录。

3. 区（Extent）
- **定义**: 区是比页大一级的存储结构，用于管理连续的页。
- **默认大小**: 一个区的默认大小为 1MB，包含 64 个连续的页（每个页 16KB）。
- **作用**: 区用于提高数据存储的连续性和访问效率，减少磁盘随机访问的开销。

4. 表空间（Tablespace）
- **定义**: 表空间是一个逻辑容器，包含多个段（Segment），每个段由一个或多个区（Extent）组成。
- **结构**: 表空间是 InnoDB 存储引擎中最高级别的存储结构，负责管理所有数据、索引和日志信息。

在 InnoDB 1.0 后，在页存储中引入了数据压缩技术，使得一个页中可以存储更多行数据，但由此页带来一个问题，即数据有压缩就有解压缩，这意味着每次跨页查询时，数据库引擎需要花费额外的 CPU 资源来进行解压缩操作，所以在检索数据时，需要尽可能少的跨页查询，将大宽表拆分成小表就是为了在每个页中存储更多的行数据，减少跨页检索。

## 表的垂直拆分

假设现在有一张系统执行日志表，如果需要通过执行时间查询执行日志，这个时间字段又由于各种原因没有建立索引，那么本身一条数据占用很大空间，又需要全表扫描，可见其性能之慢，但如果将其拆分为两个小表，将检索信息等小字段存入一张小表，利用 InnoDB 的页存储特点，可以减少扫描页的数量，然后根据检索到的 ID 回查详情表，会快很多。

即垂直拆表需要满足两个条件

- 表数据量可能超过百万
- 表中含有非常大的字段









